<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Task Manager</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <!-- VIDEO BACKGROUND -->
    <div class="video-background">
        <video id="bg-video" autoplay muted playsinline></video>
    </div>
    <div class="video-overlay"></div>

    <!-- VIDEO BACKGROUND CONTROLS -->
    <div class="bg-controls">
        <button id="bg-prev-btn"><i class="fas fa-chevron-left"></i></button>
        <span id="bg-title">Abstract</span>
        <button id="bg-next-btn"><i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- SIGN IN / SIGN UP MODAL -->
    <div id="auth-modal" class="modal">
        <div class="modal-content auth-content">
            <h1 id="auth-title">Sign In</h1>
            <form id="auth-form">
                <div class="form-group">
                    <label for="auth-username">Username</label>
                    <input type="text" id="auth-username" required>
                </div>
                <div class="form-group">
                    <label for="auth-password">Password</label>
                    <input type="password" id="auth-password" required>
                </div>
                <button type="submit" class="btn btn-primary" id="auth-submit-btn">Sign In</button>
                <p class="auth-switch">
                    Don't have an account? <a href="#" id="show-signup">Sign Up</a>
                </p>
            </form>
        </div>
    </div>

    <!-- MAIN APPLICATION (Hidden by default) -->
    <div id="app" class="container" style="display: none;">
        <header>
            <div>
                <h1>My Tasks</h1>
                <p class="welcome-user">Welcome, <span id="current-user-display"></span></p>
            </div>
            <div class="header-controls">
                <!-- NEW: Friends Button -->
                <button id="friends-btn" class="btn btn-secondary"><i class="fas fa-users"></i> Friends</button>
                <button id="stats-btn" class="btn btn-secondary"><i class="fas fa-chart-bar"></i> Stats</button>
                <button id="export-btn" class="btn btn-secondary"><i class="fas fa-download"></i> Export</button>
                <button id="sign-out-btn" class="btn btn-danger"><i class="fas fa-sign-out-alt"></i> Sign Out</button>
            </div>
        </header>

        <main>
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Search tasks...">
            </div>

            <div class="category-manager">
                <input type="text" id="category-input" placeholder="New category (e.g., Work, Personal)">
                <button id="add-category-btn">Add Category</button>
            </div>
            <div id="category-list" class="category-list"></div>

            <form id="task-form">
                <input type="text" id="task-input" placeholder="What needs to be done?" required>
                <textarea id="task-notes" placeholder="Add notes..."></textarea>
                <div class="form-row">
                    <input type="date" id="task-date">
                    <select id="task-category">
                        <option value="">No Category</option>
                    </select>
                    <select id="task-priority">
                        <option value="low">Low Priority</option>
                        <option value="medium" selected>Medium Priority</option>
                        <option value="high">High Priority</option>
                    </select>
                </div>
                <div class="form-row">
                    <select id="task-recurrence">
                        <option value="">Does Not Repeat</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                    <button type="submit">Add Task</button>
                </div>
            </form>

            <div class="filter-controls">
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="active">Active</button>
                    <button class="filter-btn" data-filter="completed">Completed</button>
                </div>
                <div class="category-filter-buttons" id="category-filter-buttons"></div>
            </div>

            <ul id="task-list"></ul>
        </main>

        <footer>
            <p id="task-count">0 tasks left</p>
            <p class="keyboard-shortcuts-hint">Press <kbd>Ctrl+K</kbd> to focus search</p>
        </footer>
    </div>

    <!-- NEW: FRIENDS MODAL -->
    <div id="friends-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Friends</h2>
            <div class="friends-section">
                <h3>Invite a Friend</h3>
                <form id="invite-form">
                    <input type="text" id="invite-username" placeholder="Enter username to invite" required>
                    <button type="submit" class="btn btn-primary">Send Invite</button>
                </form>
            </div>
            <div class="friends-section">
                <h3>Friend Requests</h3>
                <div id="friend-requests-list"></div>
            </div>
            <div class="friends-section">
                <h3>Your Friends</h3>
                <div id="friends-list"></div>
            </div>
        </div>
    </div>

    <!-- UPDATED: TASK MODAL (Now includes sharing options) -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="task-modal-title">Add Task</h2>
            <form id="edit-task-form">
                <input type="hidden" id="edit-task-id">
                <label for="edit-task-text">Task</label>
                <input type="text" id="edit-task-text" required>
                <label for="edit-task-notes">Notes</label>
                <textarea id="edit-task-notes"></textarea>
                <label for="edit-task-date">Due Date</label>
                <input type="date" id="edit-task-date">
                <label for="edit-task-category">Category</label>
                <select id="edit-task-category"></select>
                <label for="edit-task-priority">Priority</label>
                <select id="edit-task-priority">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
                
                <!-- NEW: TASK SHARING OPTIONS -->
                <div class="task-sharing-options">
                    <label>
                        <input type="checkbox" id="is-shared-task">
                        Share this task with friends
                    </label>
                    <div id="friend-select-container" style="display: none;">
                        <label>Select Friends:</label>
                        <div id="friend-checkboxes"></div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Save Task</button>
            </form>
        </div>
    </div>

    <!-- DASHBOARD MODAL -->
    <div id="dashboard-modal" class="modal">
        <div class="modal-content dashboard-content">
            <span class="close-btn">&times;</span>
            <h2>Productivity Dashboard</h2>
            <div class="dashboard-grid">
                <div class="chart-container">
                    <h3>Tasks Completed This Week</h3>
                    <canvas id="weekly-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Tasks by Category</h3>
                    <canvas id="category-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>